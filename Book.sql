USE tempdb;
GO
DECLARE @SQL nvarchar(1000);
IF EXISTS (SELECT 1 FROM sys.databases WHERE [name] = N'Book')
BEGIN
    SET @SQL = N'USE [Book];

                 ALTER DATABASE Book SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
                 USE [tempdb];

                 DROP DATABASE Book;';
    EXEC (@SQL);
END;
CREATE DATABASE Book;
GO
USE Book;
GO
IF EXISTS(SELECT * 
	FROM INFORMATION_SCHEMA.TABLES 
	WHERE TABLE_NAME = 'books' AND TABLE_SCHEMA = 'dbo')
	DROP TABLE [dbo].[books];	
GO
CREATE TABLE books(id int primary key,
					name nvarchar(200)not null,
					authorId int,
					categoryId int,
					amount int,
					price float
					);
GO
INSERT INTO books VALUES (1, 'sach1', '1', '1',1,1);
INSERT INTO books VALUES (2, 'sach2', '2', '2',2,2);
INSERT INTO books VALUES (3, 'sach3', '3', '3',3,3);
INSERT INTO books VALUES (4, 'sach4', '4', '4',4,4);
INSERT INTO books VALUES (5, 'sach5', '5', '5',5,5);
GO
SELECT * FROM books;
GO
IF EXISTS(SELECT * 
	FROM INFORMATION_SCHEMA.TABLES 
	WHERE TABLE_NAME = 'categories' AND TABLE_SCHEMA = 'dbo')
	DROP TABLE [dbo].[categories];	
GO
CREATE TABLE categories (id int primary key, name nvarchar(50) not null);
GO
INSERT INTO categories VALUES (1,'theloai1');
INSERT INTO categories VALUES (2,'theloai2');
INSERT INTO categories VALUES (3,'theloai3');
INSERT INTO categories VALUES (4,'theloai4');
INSERT INTO categories VALUES (5,'theloai5');
GO
SELECT * FROM categories;
GO
IF EXISTS(SELECT * 
	FROM INFORMATION_SCHEMA.TABLES 
	WHERE TABLE_NAME = 'books_categories' AND TABLE_SCHEMA = 'dbo')
	DROP TABLE [dbo].[books_categories];	
GO
CREATE TABLE books_categories (
				bookId int , 
				CategoryId int,
				PRIMARY KEY(bookId,CategoryId),
				CONSTRAINT fk_categories_books
					FOREIGN KEY(CategoryId)
					REFERENCES categories(id)
					ON DELETE CASCADE
					ON UPDATE CASCADE,
				CONSTRAINT fk_books_categories
					FOREIGN KEY(bookId)
					REFERENCES books(id)
					ON DELETE CASCADE
					ON UPDATE CASCADE
				);
GO
INSERT INTO books_categories VALUES (1,1);
INSERT INTO books_categories VALUES (2,2);
INSERT INTO books_categories VALUES (3,3);
INSERT INTO books_categories VALUES (4,4);
INSERT INTO books_categories VALUES (5,5);
INSERT INTO books_categories VALUES (1,5);
INSERT INTO books_categories VALUES (5,1);
INSERT INTO books_categories VALUES (3,5);
GO
SELECT * FROM books_categories;
GO
IF EXISTS(SELECT *
			FROM INFORMATION_SCHEMA.TABLES
			WHERE TABLE_NAME = 'AUTHORS' AND TABLE_SCHEMA = 'dbo')
			DROP TABLE [dbo].[AUTHORS]
GO
CREATE TABLE AUTHORS(ID INT PRIMARY KEY, NAME VARCHAR(50))

INSERT INTO AUTHORS VALUES(1,'TACGIA1');
INSERT INTO AUTHORS VALUES(2,'TACGIA2');
INSERT INTO AUTHORS VALUES(3,'TACGIA3');
INSERT INTO AUTHORS VALUES(4,'TACGIA4');
INSERT INTO AUTHORS VALUES(5,'TACGIA5');
GO
SELECT * FROM AUTHORS;
IF EXISTS (SELECT *
			FROM INFORMATION_SCHEMA.TABLES
			WHERE TABLE_NAME = 'AUTHORS_BOOKS' AND TABLE_SCHEMA = 'DBO')
			DROP TABLE AUTHORS_BOOKS
GO
CREATE TABLE AUTHORS_BOOKS(AUTHORID INT,
							BOOKID INT,
							PRIMARY KEY(AUTHORID,BOOKID),
							CONSTRAINT FK_AUTHORS_BOOKS
								FOREIGN KEY(AUTHORID)
								REFERENCES AUTHORS(ID)
								ON DELETE CASCADE
								ON UPDATE CASCADE,
							CONSTRAINT FK_BOOKS_AUTHORS
								FOREIGN KEY(BOOKID)
								REFERENCES books(id)
								ON DELETE CASCADE
								ON UPDATE CASCADE)
GO
INSERT INTO AUTHORS_BOOKS VALUES(1,1);
INSERT INTO AUTHORS_BOOKS VALUES(1,2);
INSERT INTO AUTHORS_BOOKS VALUES(2,2);
INSERT INTO AUTHORS_BOOKS VALUES(3,3);
INSERT INTO AUTHORS_BOOKS VALUES(2,3);
INSERT INTO AUTHORS_BOOKS VALUES(3,4);
INSERT INTO AUTHORS_BOOKS VALUES(4,4);
INSERT INTO AUTHORS_BOOKS VALUES(5,5);
GO
SELECT * FROM AUTHORS_BOOKS;
GO
IF EXISTS (SELECT * 
			FROM INFORMATION_SCHEMA.TABLES
			WHERE TABLE_NAME = 'ORDER_DETAILS' AND TABLE_SCHEMA = 'DBO')
			DROP TABLE [dbo].[ORDER_DETAILS]
GO
CREATE TABLE ORDER_DETAILS (ID INT PRIMARY KEY, 
							BOOKID INT FOREIGN KEY REFERENCES BOOKS(ID),
							AMOUNT INT,
							PRICE FLOAT)
GO
INSERT INTO ORDER_DETAILS VALUES (1,1,1,1)
INSERT INTO ORDER_DETAILS VALUES(2,2,2,2)
INSERT INTO ORDER_DETAILS VALUES(3,3,3,3)
INSERT INTO ORDER_DETAILS VALUES(4,4,4,4)
INSERT INTO ORDER_DETAILS VALUES(5,5,5,5)
GO
SELECT *
FROM ORDER_DETAILS
GO
IF EXISTS (SELECT *
			FROM INFORMATION_SCHEMA.TABLES
			WHERE TABLE_NAME = 'CUSTOMER' AND TABLE_SCHEMA = 'DBO')
			DROP TABLE [dbo].[ORDERS]
GO
CREATE TABLE CUSTOMER (ID INT PRIMARY KEY,
				USERNAME VARCHAR(50), 
				PASSWORD VARCHAR(50), 
				ADDRESS NVARCHAR(200),
				EMAIL VARCHAR(50))
GO
INSERT INTO CUSTOMER VALUES(1,'A','A','A','A')
INSERT INTO CUSTOMER VALUES(2,'B','B','B','B')
INSERT INTO CUSTOMER VALUES(3,'C','C','C','C')
INSERT INTO CUSTOMER VALUES(4,'D','D','D','D')
INSERT INTO CUSTOMER VALUES(5,'E','E','E','E')
GO
SELECT * FROM CUSTOMER
IF EXISTS (SELECT *
			FROM INFORMATION_SCHEMA.TABLES
			WHERE TABLE_NAME = 'ORDERS' AND TABLE_SCHEMA = 'DBO')
			DROP TABLE [dbo].[ORDERS]
GO
CREATE TABLE ORDERS (ID INT PRIMARY KEY, TOTAL FLOAT, ORDER_DETAILID INT FOREIGN KEY REFERENCES ORDER_DETAILS(ID), CUSTOMERID INT FOREIGN KEY REFERENCES CUSTOMER(ID))

INSERT INTO ORDERS VALUES(1,1,1,1)
INSERT INTO ORDERS VALUES(2,1,1,1)
INSERT INTO ORDERS VALUES(3,1,1,1)
INSERT INTO ORDERS VALUES(4,1,1,1)
INSERT INTO ORDERS VALUES(5,1,1,1)
SELECT * FROM ORDERS
